# 리다이렉션과 부하 균형
- [리다이렉션과 부하 균형](#리다이렉션과-부하-균형)
  - [왜 리다이렉트?](#왜-리다이렉트)
  - [리다이렉트 대상](#리다이렉트-대상)
    - [웹서버](#웹서버)
    - [프록시](#프록시)
  - [리다이렉션 프로토콜의 개요](#리다이렉션-프로토콜의-개요)
    - [목표](#목표)
    - [개요](#개요)
    - [리다이렉션 방법(메시지 -> 서버)](#리다이렉션-방법메시지---서버)
      - [HTTP 리다이렉션](#http-리다이렉션)
      - [DNS 리다이렉션](#dns-리다이렉션)
      - [임의캐스트 어드레싱(anycast addressing)](#임의캐스트-어드레싱anycast-addressing)
      - [아이피 맥(MAC) 포워딩](#아이피-맥mac-포워딩)
      - [IP 주소 포워딩](#ip-주소-포워딩)
    - [리다이렉션 방법(메시지 -> 프록시 서버](#리다이렉션-방법메시지---프록시-서버)
      - [명시적인 브라우저 설정](#명시적인-브라우저-설정)
      - [프록시 자동설정(Proxy Auto-Configuration, PAC)](#프록시-자동설정proxy-auto-configuration-pac)
      - [웹 프록시 자동발견 프로토콜(Web Proxy Auto-Discover, WPAD)](#웹-프록시-자동발견-프로토콜web-proxy-auto-discover-wpad)
      - [웹 캐시 조직 프로토콜(Web Cache Coordination, WCCP)](#웹-캐시-조직-프로토콜web-cache-coordination-wccp)
      - [인터넷 캐시 프로토콜(Internet Cache Protocol, ICP)](#인터넷-캐시-프로토콜internet-cache-protocol-icp)
      - [캐시배열 라우팅 프로토콜(Cache Array Routing Protocol, CARP)](#캐시배열-라우팅-프로토콜cache-array-routing-protocol-carp)
      - [하이퍼텍스트 캐싱 프로토콜(Hyper Text Caching Protocol, HTCP)](#하이퍼텍스트-캐싱-프로토콜hyper-text-caching-protocol-htcp)
  - [일반적인 리다이렉션 방법](#일반적인-리다이렉션-방법)
    - [HTTP 리다이렉션](#http-리다이렉션-1)
    - [DNS 리다이렉션](#dns-리다이렉션-1)
      - [다중 주소와 라운드 로빈](#다중-주소와-라운드-로빈)
      - [DNS 캐싱](#dns-캐싱)
      - [리다이렉션 방법](#리다이렉션-방법)
## 왜 리다이렉트?
HTTP 애플리케이션은 다음 3가지를 원한다!
- 신뢰할 수 있는 HTTP 트랜잭션의 수행
- 지연 최소화
- 네트워크 대역폭 절약

- 해당 이유들로 웹 콘텐츠는 여러 장소에 배포된다.
  - 한 곳에서 실패하면 다른 곳을 이용할 수 있으므로 신뢰성이 개선된다. 
  - 클라이언트가 가까운 리소스에 접근하여 콘텐츠를 더 빨리 받을 수 있다.
  - 목적지 서버가 분산되어 네트워크 혼잡도를 줄여준다.
- 주의사항
  - 부하 균형

## 리다이렉트 대상
### 웹서버
- IP 별로 요청을 다룸
- 복제된 서버들로요청을 분산
- 같은 URL로 온 여러 요청을 최적의 웹서버로 전달

### 프록시
- 프로토콜별로 요청을 다룸
- 프록시 이웃의 모든 HTTP 트래픽은 프록시를 거쳐야한다.
- 프록시로의 리다이렉트는 주 진입로의 트래픽을 근처에 있는 지름길로 인도하는 것

## 리다이렉션 프로토콜의 개요
### 목표
> HTTP 메시지를 가용한 웹 서버로 가능한 빨리 보내는 것

### 개요
- 브라우저 자용자는 브라우저가 클라이언트 메시지를 프록시서버로 보낼 수 있도록 설정 가능
- DNS 분석자(DNS resolver)는 메시지의 주소를 지정할 때 사용될 IP 주소를 선택 -> ip 주소는 클라이언트의 지리적 위치에 따라 달라질 수 있다.
- 메시지는 주소가 지정된 여러개의 패킷으로 분리되어 전달 -> 스위치와 라우터는 패킷의 TCP/IP 주소를 검증하고 라우팅 경로 설정
- 웹 서버는 HTTP 리다이렉트를 이용해 요청이 다른 웹 서버로 가도록 한다.

### 리다이렉션 방법(메시지 -> 서버)
#### HTTP 리다이렉션
- 어떻게
  - HTTP 요청은 가용한 첫번째 웹 서버로 보냄
  - 해당 웹 서버는 클아이언트에게 선택한 서버로의 HTTP 리다이렉트를 보내준다.
  - 클라이언트는 선택된 서버에게 다시 요청을 보낸다.
- 근거
  - 라운드 로빈
- 제약사항
  - 모든 트랙잭션이 추가 리다이렉트 단계를 포함하게 되어 느릴 수 있다.
  - 반드시 첫번째웹서버가 요청 부하를 다룰 수 있어야한다.
  
#### DNS 리다이렉션
- 어떻게 
  - DNS 서버가 URL의호스트 명에 대한 응답으로 어떤 IP 주소를 사용할지 결정한다.
- 목적
  - 라운드로빈 부하 균형
  - 회전 지연 최소화
  - 최단 거리 선정
- 제약사항
  - DNS 서버를 설정해야한다.

#### 임의캐스트 어드레싱(anycast addressing)
- 어떻게 
  - 여러 서버가 같은 ip 주소를 사용
  - 각 서버는 백본 라우터인 척
  - 그 외 라우터들은 공유된 ip 주소로 향하는 패킷을 가장 가까운 서버로 전송
- 목적
  - 라우터들은 내장된 최단거리 라우팅 기능을 사용
- 제약사항
  - 라우터에 설정해야한다.
  - 주소가 충돌할 위험이 있다
  
#### 아이피 맥(MAC) 포워딩
- 어떻게 
  - 스위치나 라우터 같은 네트워크 요소가 패킷의 목적지 주소를 읽는다.
  - 패킷이 리다이렉트되어야하면 스위치는 패킷에게 서버나 프록시의 목적지 MAC 주소를 준다.
- 목적
  - 대역폭을 절약하고 QoS(Quality of Service)를 개선
- 제약사항
  - 서버나 프록시는 반드시 한 홉 거리에 있어야한다.
  
#### IP 주소 포워딩
- 어떻게 
  - 레이어4 스위치는 패킷의 목적지 포트를 평가
  - 리다이렉트 패킷의 아이피 주소를 프록시나 미러링된 서버의 아이피 주소로 변환
- 목적
  - 대역폭을 절약하고 QoS를 개선
- 제약사항
  - 서버나 프록시가 클라이언트의 IP주소를 잃어버릴 수 있다.

### 리다이렉션 방법(메시지 -> 프록시 서버
#### 명시적인 브라우저 설정
- 대역폭 절약 및 품질 개선
- 브라우저의 설정 능력에 의존해야함
- 웹 브라우저는가까운 프록시에게 HTTP 메시지를 보내도록 설정

#### 프록시 자동설정(Proxy Auto-Configuration, PAC)
- 대역폭 절약 및 품질 개선
- 브라우저는 반드시설정된 서버로 질의를 보내도록 설정해야함
- 웹 브라우저는 설정 서버로부터 PAC 파일을 검색하여 브라우저에게 각 URL에 대해 어떤 프록시를 사용해야하는지 인식

#### 웹 프록시 자동발견 프로토콜(Web Proxy Auto-Discover, WPAD)
- 설정 서버는 HTTP 요청 헤더에서 얻은 정보를 기반으로 PAC파일의 URL설정
- 브라우저는 설정 서버에게 PAC 파일에 대한 URL을 요청하고 특정 설정 서버로 설정할 필요없음

#### 웹 캐시 조직 프로토콜(Web Cache Coordination, WCCP)
#### 인터넷 캐시 프로토콜(Internet Cache Protocol, ICP)
#### 캐시배열 라우팅 프로토콜(Cache Array Routing Protocol, CARP)
#### 하이퍼텍스트 캐싱 프로토콜(Hyper Text Caching Protocol, HTCP)
- 프록시 캐시 해싱 프로토콜
- 캐시가 요청을 부모 캐시로 전달할 수 있도록 한다.
- 캐시의 콘텐츠는 분산되고 캐시의 무리는 하나의 큰 캐시처럼 동작

## 일반적인 리다이렉션 방법
### HTTP 리다이렉션
- 리다이렉션을 통한 부하 분산
- 단점
  - 어떤 서버로 리다이렉트 할지 결정하기 위해 원 서버의 처리량이 증가한다. 
  - 페이지에 두번 접근해야하므로 지연시간 증가
  - 리다이렉트 서버에 문제가 발생하면 대처 필요
### DNS 리다이렉션
- 분산된 서버의 ip주소를 클라이언트로 제공하여 부하 분산
#### 다중 주소와 라운드 로빈
- 대부분의 DNS 클라이얹트는 다중 주소 집합의 첫번째 주소를 사용
#### DNS 캐싱
- 주소 순환을 통해 부하 분산
- 전달된 DNS 룩업의 결과가 재사용될 수 있다.
- 기억된 주소가 게속 사용되면 부하가 집중될 수 있다.

#### 리다이렉션 방법
- 부하 균형 알고리즘: 가장 로드가 적은 웹서버의 주소 반환
- 근접 라우팅 알고리즘: 웹 서버의 팜이 지리적으로 분산된 경우 가까운 서버 주소 반환
- 결함 마스킹 알고리즘: 네트워크 건강 상태를 모니터링하고 장애를 피해서 라우팅
